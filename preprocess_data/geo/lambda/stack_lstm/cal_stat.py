import numpy as np
import scikit_posthocs
import pandas as pd
from scipy.stats import wilcoxon

"""
2	3.5	10	1	8	6	10	5	3.5	10	6
2	5	8	1	10	7	6	4	9	11	2
3	4	5	2	9	11	8	1	6	10	6
2	11	5	8.5	7	10	3	6	1	4	7.5
1	11	3	7	4.5	6	8	10	4.5	2	8

2	1	9	4	11	7	10	6	8	3	4
4	1	8	9	5	2	10	6	11	7	3
3	6	10	4.5	1	2	7	11	8	9	3.5
2	1	10	9	4.5	4.5	11	8	6	7	2
1	8	7	10	2	3	6	11	9	5	3

1	10	11	4	2	3	8	9	6	5	6
1	9	11	3	4	2	8	7	10	5	5
3	1	10	6	4	5	8	11	9	7	2
1	2	10	6	4	5	3	11	7	8	8
1	6	10	2	9	3	4	11	5	7	7

1	4	9	3	5.5	2	7.5	10	7.5	11	4.5
1	10.5	5	2	6.5	8.5	6.5	4	10.5	8.5	2
1	11	3	7	10	9	6	8	4.5	2	3.5
1	10.5	2	10.5	4	5	8	7	9	3	5
1.5	10	1.5	4	5	7	8	3	9	11	5
										
										
3	5	11	8	6.5	1	6.5	10	9	2	3
7	11	6	9	1	2	3	4	5	10	7
1	10	8	7	3	2	6	11	5	9	3
1	7	9	8	3	2	4	11	10	6	4
1	9	10.5	6	4	2	7.5	10.5	5	3	6.5
										
										
3	6.5	6.5	8	2	1	4	10.5	9	10.5	4
4	8	7	6	1	5	2	10	9	11	3
1	6	9	5	4	2.5	7	11	9	9	1.5
1	4	7	6	9	2	5	10.5	8	10.5	2
1	4.5	9	7	2	3	8	6	10	11	3.5

"""

permance_matrix = np.array([[29.91, 17.76, 7.48, 47.66, 9.35, 14.02, 7.48, 15.89, 17.76, 7.48, 13.08],
                            [28.04, 12.15, 6.54, 35.51, 5.61, 10.28, 11.21, 13.08, 6.45, 4.67, 14.95],
                            [37.38, 34.58, 29.91, 42.99, 24.3, 18.69, 25.23, 51.4, 28.97, 23.34, 28.03],
                            [18.69, 5.61, 14.02, 8.41, 10.28, 6.54, 16.82, 12.15, 21.5, 15.89, 8.41],
                            [48.59, 10.28, 39.25, 17.75, 23.36, 19.63, 16.82, 14.95, 23.36, 41.12, 15.88],

                            [21.74, 26.48, 6.58, 18.31, 4.48, 16.21, 5.8, 17.13, 16.2, 19.37, 18.05],
                            [18.45, 23.85, 6.59, 6.06, 16.34, 21.08, 5.27, 13.44, 4.84, 8.04, 19.63],
                            [25.69, 13.83, 2.37, 17, 31.09, 26.48, 11.9, 0.4, 3.69, 2.5, 17],
                            [19.37, 21.48, 7.51, 7.91, 16.73, 16.73, 5.67, 8.03, 14.22, 8.3, 17.52],
                            [27.14, 3.03, 3.16, 1.58, 25.16, 24.9, 4.08, 0.53, 1.71, 8.04, 8.56],

                            [49.03, 12.14, 11.17, 38.35, 44.66, 39.32, 18.93, 16, 29.61, 34.47, 29.13],
                            [54.85, 25.73, 18.45, 38.35, 37.37, 40.29, 27.18, 28.15, 25.24, 34.47, 32.52],
                            [43.69, 47.57, 17.96, 38.35, 43.2, 41.75, 36.41, 9.2, 24.76, 36.89, 46.17],
                            [49.03, 29.13, 5.83, 15.53, 20.39, 19.9, 25.73, 2.91, 13.6, 12.14, 11.17],
                            [42.72, 28.16, 17.48, 37.38, 19.42, 36.89, 33.98, 15.53, 33.01, 26.7, 21.36],

                            [33.64, 8.18, 3.64, 9.09, 6.36, 12.73, 4.55, 2.73, 4.55, 2.7, 6.36],
                            [24.55, 1.82, 5.45, 15.45, 4.55, 3.64, 4.55, 8.41, 1.82, 3.64, 9.09],
                            [27.27, 11.82, 23.64, 20, 14.55, 15.45, 20.91, 18.18, 22.73, 24.55, 22.73],
                            [22.73, 3.64, 13.64, 3.64, 9.09, 8.18, 5.45, 5.55, 4.55, 11.82, 7.27],
                            [27.27, 8.18, 27.27, 22.73, 21.82, 14.55, 13.64, 23.64, 12.73, 5.45, 18.18],

                            [27.49, 25.13, 15.63, 20.38, 21.8, 29.38, 21.8, 17.5, 17.53, 28.44, 26.54],
                            [3.32, 0.95, 4.27, 1.9, 18.01, 9.48, 9, 8, 7.59, 1.42, 2.84],
                            [31.28, 3.32, 4.74, 5.69, 17.54, 23.22, 6.64, 2.8, 9.48, 4.27, 11.85],
                            [42.18, 20.38, 17.54, 18.01, 27.96, 36.49, 25.12, 8.5, 17.53, 21.33, 24.17],
                            [31.28, 1.98, 1.42, 10.9, 14.69, 21.8, 6.64, 1.42, 13.74, 17.06, 6.64],

                            [16.49, 5.24, 5.24, 4.45, 26.7, 34.29, 8.9, 0, 2.88, 0, 8.37],
                            [9.56, 2.36, 2.75, 3.14, 29.19, 8.51, 20.68, 0.13, 1.44, 0, 10.6],
                            [16.49, 1.18, 0.13, 1.7, 12.83, 14.27, 0.92, 0, 0.13, 0.13, 14.27],
                            [24.35, 3.01, 1.78, 2.09, 1.31, 14.66, 2.23, 0, 1.57, 0, 8.77],
                            [29.45, 14.53, 5.1, 10.86, 16.1, 15.45, 7.07, 11.12, 4.45, 1.96, 14.53]])

test_matrix = np.array([[2, 3.5, 10, 1, 8, 6, 10, 5, 3.5, 10, 6],
                        [2, 5, 8, 1, 10, 7, 6, 4, 9, 11, 2],
                        [3, 4, 5, 2, 9, 11, 8, 1, 6, 10, 6],
                        [2, 11, 5, 8.5, 7, 10, 3, 6, 1, 4, 7.5],
                        [1, 11, 3, 7, 4.5, 6, 8, 10, 4.5, 2, 8],

                        [2, 1, 9, 4, 11, 7, 10, 6, 8, 3, 4],

                        [4, 1, 8, 9, 5, 2, 10, 6, 11, 7, 3],
                        [3, 6, 10, 4.5, 1, 2, 7, 11, 8, 9, 3.5],
                        [2, 1, 10, 9, 4.5, 4.5, 11, 8, 6, 7, 2],
                        [1, 8, 7, 10, 2, 3, 6, 11, 9, 5, 3],

                        [1, 10, 11, 4, 2, 3, 8, 9, 6, 5, 6],
                        [1, 9, 11, 3, 4, 2, 8, 7, 10, 5, 5],
                        [3, 1, 10, 6, 4, 5, 8, 11, 9, 7, 2],
                        [1, 2, 10, 6, 4, 5, 3, 11, 7, 8, 8],
                        [1, 6, 10, 2, 9, 3, 4, 11, 5, 7, 7],

                        [1, 4, 9, 3, 5.5, 2, 7.5, 10, 7.5, 11, 4.5],
                        [1, 10.5, 5, 2, 6.5, 8.5, 6.5, 4, 10.5, 8.5, 2],
                        [1, 11, 3, 7, 10, 9, 6, 8, 4.5, 2, 3.5],
                        [1, 10.5, 2, 10.5, 4, 5, 8, 7, 9, 3, 5],
                        [1.5, 10, 1.5, 4, 5, 7, 8, 3, 9, 11, 5],

                        [3, 5, 11, 8, 6.5, 1, 6.5, 10, 9, 2, 3],
                        [7, 11, 6, 9, 1, 2, 3, 4, 5, 10, 7],
                        [1, 10, 8, 7, 3, 2, 6, 11, 5, 9, 3],
                        [1, 7, 9, 8, 3, 2, 4, 11, 10, 6, 4],
                        [1, 9, 10.5, 6, 4, 2, 7.5, 10.5, 5, 3, 6.5],

                        [3, 6.5, 6.5, 8, 2, 1, 4, 10.5, 9, 10.5, 4],
                        [4, 8, 7, 6, 1, 5, 2, 10, 9, 11, 3],
                        [1, 6, 9, 5, 4, 2.5, 7, 11, 9, 9, 1.5],
                        [1, 4, 7, 6, 9, 2, 5, 10.5, 8, 10.5, 2],
                        [1, 4.5, 9, 7, 2, 3, 8, 6, 10, 11, 3.5],

                        ])

# test_matrix = np.array([[21.74,26.48,6.58,18.31,4.48,16.21,5.8,17.13,16.2,19.37,18.05],
# [18.45,23.85,6.59,6.06,16.34,21.08,5.27,13.44,4.84,8.04,19.63],
# [25.69,13.83,2.37,17,31.09,26.48,11.9,0.4,3.69,2.5,17],
# [19.37,21.48,7.51,7.91,16.73,16.73,5.67,8.03,14.22,8.3,17.52],
# [27.14,3.03,3.16,1.58,25.16,24.9,4.08,0.53,1.71,8.04,8.56]]).T
"""
test_matrix = np.array([[0.60785324, 0.61440499, 0.58259179, 0.62093956, 0.60601833,
        0.62020864, 0.63394675, 0.62714066, 0.61424252, 0.63700369],
       [0.60633548, 0.60122064, 0.5699726 , 0.60301325, 0.59595725,
        0.59791083, 0.61473163, 0.60286638, 0.60811504, 0.63009068],
       [0.61641485, 0.62513144, 0.58934988, 0.61052178, 0.61656882,
        0.62829806, 0.64243387, 0.6219826 , 0.62502894, 0.64509667],
       [0.48035034, 0.50608212, 0.48603005, 0.48932625, 0.46643116,
        0.49742805, 0.49639745, 0.49457921, 0.49865094, 0.51385576]])
"""

coarse_fine_pt_diff = [15.89, 17.76, 18.69, 12.15, 28.96,
                       5.53, -2.63, -0.79, 2.64, 2.24,
                       9.71, 14.56, 1.94, 29.13, 5.83,
                       20.91, 20.91, 11.82, 14.55, 12.72,
                       -1.89, -6.16, 8.06, 5.69, 9.48,
                       -17.8, 1.05, 2.22, 9.69, 14]
irnet_comb_diff = [-1.87, 4.68,
                   -9.35, -8.41, 20.55, -4.61, -3.42, 20.55, 2.24, 18.97, 0.49, 11.16, -0.48, 6.31, 1.46, 3.64, 11.82,
                   1.82, 14.55, 7.27, -0.95, -16.11, 18.48, 21.8, 2.84, 9.95, 3.67, 14.79, 23.7,
                   16.23]
irnet_os_diff = [-0.93,12.15
,-10.28,-3.74,11.21,-4.61,-5.4,13.17,0,18.97,4.86,0.97,-1.94,19.42,11.17,15.46,12.73,5.45,20,7.27
,4.27,-6.63,21.33,17.06,7.11,11.91,5.37,15.18,23.7,15.44]

irnet_pt_diff = [4.68,18.74,
9.34,
3.74,
30.83,
8.83,
6.33,
-6.2,
1.06,
1.84,
12.14,
14.07,
3.4,
17.96,
16.51,
10,
18.19,
5.45,
15.46,
6.36,
0,
0.48,
2.84,
16.59,
15.64,
-4.19,
1.31,
-0.92,
4.85,
9.69]
"""
15.89,17.76,18.69,12.15,28.96,
5.53,-2.63,-0.79,2.64,2.24,
9.71,14.56,1.94,29.13,5.83,
20.91,20.91,11.82,14.55,12.72,
-1.89,-6.16,8.06,5.69,9.48,
-17.8,1.05,2.22,9.69,14
"""
abl_smooth_diff = [3.74, -4.67, 3.74, 0, 5.6, 3.03, 0.79, 5.53, 1.72, 7.77, 5.34, 3.4, -3.4, 11.17, 0.97,
                   4.55, -3.63, 2.72, 2.73, 7.27, 1.42, -3.32, 8.06, -2.37,
                   13.74, -0.92, -0.91, 15.97, -4.18, 10.21]
abl_reg_diff = [1.87, -2.8, -0.94, 0, 9.34, 1.19, -4.47, 12.78, 3.3, 15.55, 12.62, 13.59, -0.97,
                7.28, 16.02, 0, -2.72, -7.28, 0.91, -1.82, 7.11, 1.9, 11.85, 16.11, 8.06, 10.08, 0.53, 1.96, 6.03,
                11.52]

abl_matrix = np.array([

    [29.91, 28.04, 27.1, 27.1, 26.17],
    [28.04, 30.84, 28.97, 28.97, 32.71],
    [37.38, 38.32, 36.45, 31.78, 33.64],
    [18.69, 18.69, 14.95, 22.43, 18.69],
    [48.59, 39.25, 27.1, 35.51, 42.99],

    [21.74, 20.55, 9.62, 11.73, 18.71],
    [18.45, 22.92, 18.45, 17.26, 17.66],
    [25.69, 12.91, 17.13, 23.19, 20.16],
    [19.37, 16.07, 17.39, 17.39, 17.65],
    [27.14, 11.59, 11.86, 23.32, 19.37],

    [47.57, 34.95, 43.67, 47.09, 46.12],
    [54.37, 40.78, 48.06, 33.01, 50],
    [47.57, 48.54, 26.7, 43.67, 51.46],
    [50.48, 43.2, 46.12, 35.92, 39.32],
    [46.6, 30.58, 33.01, 34.95, 37.86],

    [33.64, 33.64, 25.45, 30.91, 29.09],
    [24.55, 27.27, 26.36, 24.55, 28.18],
    [27.27, 34.55, 28.18, 20.91, 24.55],
    [22.73, 21.82, 10.91, 17.27, 20],
    [27.27, 29.09, 27.27, 20.91, 20],

    [27.49, 20.38, 25.59, 29.38, 26.07],
    [3.32, 1.42, 2.37, 2.37, 6.64],
    [31.28, 19.43, 24.65, 19.91, 23.22],
    [42.18, 26.07, 25.12, 22.75, 44.55],
    [31.28, 23.22, 16.59, 19.43, 17.54],

    [16.49, 6.41, 7.85, 7.85, 17.41],
    [9.56, 9.03, 10.21, 10.73, 10.47],
    [16.49, 14.53, 14.01, 15.05, 0.52],
    [24.35, 18.32, 15.97, 15.31, 28.53],
    [29.45, 17.93, 16.49, 19.37, 19.24],
])
w, p = wilcoxon(coarse_fine_pt_diff)

print(p)

nemenyi = scikit_posthocs.posthoc_nemenyi_friedman(permance_matrix)

dunn = scikit_posthocs.posthoc_dunn(abl_matrix.T)

print(dunn)
print(nemenyi)

x = [[1, 2, 3, 5, 1], [12, 31, 54, np.nan], [10, 12, 6, 74, 11]]
yi = scikit_posthocs.posthoc_nemenyi(x)

print(yi)

x = np.array([[31, 27, 24], [31, 28, 31], [45, 29, 46], [21, 18, 48], [42, 36, 46], [32, 17, 40]])
ci = scikit_posthocs.posthoc_nemenyi_friedman(x)
print(ci)

data = pd.DataFrame.from_dict({'blocks': {0: 0, 1: 1, 2: 2, 3: 3, 4: 0, 5: 1, 6:
    2, 7: 3, 8: 0, 9: 1, 10: 2, 11: 3, 12: 0, 13: 1, 14: 2, 15: 3}, 'groups': {0:
                                                                                   0, 1: 0, 2: 0, 3: 0, 4: 1, 5: 1,
                                                                               6: 1, 7: 1, 8: 2, 9: 2, 10: 2, 11: 2,
                                                                               12: 3,
                                                                               13: 3, 14: 3, 15: 3},
                               'y': {0: 8.82, 1: 8.92, 2: 8.27, 3: 8.83, 4: 11.8, 5:
                                   9.58, 6: 11.46, 7: 13.25, 8: 10.37, 9: 10.59, 10: 10.24, 11: 8.33, 12: 12.08,
                                     13: 11.89, 14: 11.6, 15: 11.51}})

print(scikit_posthocs.posthoc_nemenyi_friedman(data, y_col='y', block_col='blocks', group_col='groups', melted=True))
